{% if env == 'development' %}
  {% if type == 'brochure' %}
    {% extends './brochure.njk' %}
  {% else %}
    {% extends './page.njk' %}
  {% endif %}
{% else %}
  {% extends './prod.njk' %}
{% endif %}

{% if env == 'stage' %}
  {% set logo %}
  {% include "images/logo_stage.svg" %}
  {% endset %}
{% else %}
  {% set logo %}
  {% include "images/logo.svg" %}
  {% endset %}
{% endif %}

{% block content %}

  {% set css %}
  {% include "styles/main.css" %}
  {% if type == 'brochure' %}
    {% include "styles/brochure.css" %}
  {% endif %}
  {% endset %}

  {% set js %}
  {% include "scripts/smoothscroll.js" %}
  {% include "scripts/toc.js" %}
  {% include "scripts/planes.js" %}
  {% endset %}

  <style>
    {{css | postcss | safe}}
  </style>

  <div  x-data="{ scroll: '' }" id="app">
    <div class="absolute top-[102vh] overflow-none h-[calc(100%-102vh)] w-full pointer-events-none -z-50" x-intersect:enter="scroll = 'bg-opacity-90'" x-intersect:leave="scroll = ''">&nbsp;</div>

    {% include "./nav.njk" %}
    <div class="text-base flex flex-row justify-center px-8 my-5 z-10 mx-auto w-full">
      <div class="max-w-[calc(65ch+16.25rem)] flex-1 flex flex-col gap-3 items-center navSmall:items-start">
        <div class="prose">
          <h1 class="text-center navSmall:text-left">{{ title }}</h1>
        </div>
        {% include "./breadcrumbs.njk" %}
      </div>
    </div>
    <div class="content min-h-screeen flex flex-col lg:flex-row justify-center px-8 my-5 z-10 relative gap-5">
      <div x-data="{ toc: !!document.querySelector('.table-of-contents')}" x-show="toc" class="grow order-first lg:order-last max-w-[15rem] prose" x-cloak>
        <div class="lg:sticky lg:top-20 text-base">
          <h3 class="my-0 mb-5">Table of Contents</h3>
          <div class="table-of-contents-container lg:h-full lg:max-h-[calc(80vh-72px)] lg:overflow-y-auto overflow-x-hidden">&nbsp;</div>
        </div>
      </div>
      <div class="prose flex-initial order-last lg:order-first">
        {% if env == 'stage' %}
          <h1>Stage Test</h1>
        {% endif %}

        {{ content | safe }}
      </div>
    </div>

    <footer class="bg-opacity-85 bg-black relative">
      <div class="py-5 flex flex-col justify-center items-center text-gray-400 text-xslg:text-sm text-center text-primary-content text-opacity-70 focus:outline-none font-medium">
        <a href="{{ link('pages') }}" class="h-8 mb-2">{{ logo | safe }}</a>

        <span>&copy; {% year %} Liberty University. All Rights Reserved.</span>

        <a class="mt-1 text-accent underline hover:text-accent-focus flex items-center justify-center gap-1" href="https://www.liberty.edu/osd/lu-send/staff/">
          <ion-icon name="call-outline">&nbsp;</ion-icon>
          <span>Contact Us</span>
        </a>

        <a class="text-primary-content text-opacity-70 hover:text-opacity-50 underline flex items-center justify-center gap-1" href="{{ edit }}">
          <ion-icon name="create-outline">&nbsp;</ion-icon>
          <span>Edit Page</span>
        </a>
      </div>
    </footer>

    <div id="planes" class="fixed top-0 left-0 w-full h-full z-0 pointer-events-none">&nbsp;</div>
  </div>

  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tsparticles/1.37.5/tsparticles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-particles@1.37.5/dist/jquery.particles.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mousetrap/1.6.5/mousetrap.min.js"></script>

  <script>
    {{ js | safe }}
  </script>

  <script defer src="https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

{% endblock %}
